Sub RemoveDuplicatesFromWorkbook(ByVal wb As Excel.Workbook)
    Dim lastRow As Long
    Dim ws As Excel.Worksheet
    Dim rngSubject As Excel.Range
    Dim rngReceived As Excel.Range
    Dim subjectDict As Object ' Dictionary to track subjects and their latest received date
    
    Set ws = wb.Worksheets(1)
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
    Set rngSubject = ws.Range(ws.Cells(1, 1), ws.Cells(lastRow, 1)) ' Subject column (Column A)
    Set rngReceived = ws.Range(ws.Cells(1, 2), ws.Cells(lastRow, 2)) ' Received column (Column B)

    ' Create a Dictionary to track subjects and their latest received date
    Set subjectDict = CreateObject("Scripting.Dictionary")
    
    Dim subjectCell As Range
    Dim receivedCell As Range
    Dim rowIndex As Long
    For rowIndex = lastRow To 2 Step -1 ' Start from the last row and loop backward
        Set subjectCell = rngSubject.Cells(rowIndex, 1)
        Set receivedCell = rngReceived.Cells(rowIndex, 1)
        If Not subjectCell.Value = "" Then
            If Not subjectDict.Exists(subjectCell.Value) Then
                ' Add subject and its received date to the dictionary if it doesn't exist
                subjectDict.Add subjectCell.Value, receivedCell.Value
            Else
                ' If the subject is already in the dictionary, compare received dates and update if necessary
                If receivedCell.Value > subjectDict(subjectCell.Value) Then
                    subjectDict(subjectCell.Value) = receivedCell.Value
                End If
                ' Delete the entire row since we're keeping the latest occurrence
                ws.Rows(subjectCell.Row).Delete
            End If
        End If
    Next rowIndex
End Sub
