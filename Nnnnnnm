Sub MoveExternalEmails()

    Dim olApp As Object
    Dim olNamespace As Object
    Dim olInbox As Object
    Dim olAgedInternalFolder As Object
    Dim olAgedExternalFolder As Object
    Dim olItem As Object
    Dim i As Integer
    Dim targetEmail As String
    
    ' Define the target email address
    targetEmail = "kushal-ajith.shetty@ubs.com" ' Replace with the desired email address
    
    Set olApp = CreateObject("Outlook.Application")
    Set olNamespace = olApp.GetNamespace("MAPI")
    
    ' Find the specific email account based on the target email address
    For Each olInbox In olNamespace.Folders
        If olInbox.Name = targetEmail Then
            Exit For
        End If
    Next olInbox
    
    If olInbox Is Nothing Then
        MsgBox "Email account not found!", vbExclamation
        Exit Sub
    End If
    
    ' Check if "(1) AGED External" folder already exists or create it
    On Error Resume Next
    Set olAgedExternalFolder = olInbox.Folders("(1) AGED External")
    On Error GoTo 0
    
    If olAgedExternalFolder Is Nothing Then
        Set olAgedExternalFolder = olInbox.Folders.Add("(1) AGED External", olFolderInbox)
    End If
    
    ' Find the "(1) AGED Internal" folder
    On Error Resume Next
    Set olAgedInternalFolder = olInbox.Folders("(1) AGED Internal")
    On Error GoTo 0
    
    If olAgedInternalFolder Is Nothing Then
        MsgBox "(1) AGED Internal folder not found!", vbExclamation
        Exit Sub
    End If
    
    For i = olAgedInternalFolder.Items.Count To 1 Step -1
        Set olItem = olAgedInternalFolder.Items(i)
        If olItem.Class = 43 Then ' MailItem Class
            If Not olItem.SenderEmailType = "EX" Then
                ' Check if sender's domain is ubs.com (internal)
                If Right(olItem.SenderEmailAddress, 7) <> "ubs.com" Then
                    olItem.Move olAgedExternalFolder
                End If
            End If
        End If
    Next i
    
    Set olItem = Nothing
    Set olAgedExternalFolder = Nothing
    Set olAgedInternalFolder = Nothing
    Set olInbox = Nothing
    Set olNamespace = Nothing
    Set olApp = Nothing
    
End Sub
