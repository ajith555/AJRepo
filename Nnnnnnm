Sub MoveExternalEmails()

    Dim olApp As Object
    Dim olNamespace As Object
    Dim olInbox As Object
    Dim olAgedInternalFolder As Object
    Dim olAgedExternalFolder As Object
    Dim olItem As Object
    Dim i As Integer
    
    Set olApp = CreateObject("Outlook.Application")
    Set olNamespace = olApp.GetNamespace("MAPI")
    
    ' Find the inbox folder
    On Error Resume Next
    Set olInbox = olNamespace.GetDefaultFolder(6) ' Inbox Folder (6)
    On Error GoTo 0
    
    If olInbox Is Nothing Then
        MsgBox "Inbox folder not found!", vbExclamation
        Exit Sub
    End If
    
    ' Find the "(1) AGED Internal" folder
    Set olAgedInternalFolder = FindSubFolder(olInbox, "(1) AGED Internal")
    
    If olAgedInternalFolder Is Nothing Then
        MsgBox "(1) AGED Internal folder not found!", vbExclamation
        Exit Sub
    End If
    
    ' Check if "(1) AGED External" folder already exists or create it
    Set olAgedExternalFolder = FindSubFolder(olInbox, "(1) AGED External")
    
    If olAgedExternalFolder Is Nothing Then
        Set olAgedExternalFolder = olInbox.Folders.Add("(1) AGED External", olFolderInbox)
    End If
    
    For i = olAgedInternalFolder.Items.Count To 1 Step -1
        Set olItem = olAgedInternalFolder.Items(i)
        If olItem.Class = 43 Then ' MailItem Class
            If Not olItem.SenderEmailType = "EX" Then
                ' Check if sender's domain is ubs.com (internal)
                If Right(olItem.SenderEmailAddress, 7) <> "ubs.com" Then
                    olItem.Move olAgedExternalFolder
                End If
            End If
        End If
    Next i
    
    Set olItem = Nothing
    Set olAgedExternalFolder = Nothing
    Set olAgedInternalFolder = Nothing
    Set olInbox = Nothing
    Set olNamespace = Nothing
    Set olApp = Nothing
    
End Sub

Function FindSubFolder(ByVal parentFolder As Object, ByVal folderName As String) As Object
    Dim subFolder As Object
    On Error Resume Next
    Set subFolder = parentFolder.Folders(folderName)
    On Error GoTo 0
    Set FindSubFolder = subFolder
End Function
