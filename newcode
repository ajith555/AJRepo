# Set the path to your CSV file
$csvPath = "C:\path\to\your\file.csv"

# Open the CSV file
Invoke-Item $csvPath

# Read the CSV file
$urls = Import-Csv -Path $csvPath

# Define the Chrome executable path
$chromePath = "C:\Program Files\Google\Chrome\Application\chrome.exe"

# Define the download directory
$downloadDirectory = "C:\Users\shettyka\Downloads"  # Adjust as per your system

# Define the batch size for opening URLs
$batchSize = 50

# Loop through URLs in batches
for ($i = 0; $i -lt $urls.Count; $i += $batchSize) {
    $batch = $urls[$i..($i + $batchSize - 1)]

    # Open Chrome with the first URL in the batch
    Start-Process -FilePath $chromePath -ArgumentList $batch[0].url

    # Loop through each URL in the batch, starting from the second one
    foreach ($url in $batch[1..($batch.Count - 1)]) {
        # Wait for 10 seconds
        Start-Sleep -Seconds 10

        # Check if a file has been downloaded
        $downloadedFiles = Get-ChildItem -Path $downloadDirectory
        $fileDownloaded = $false
        $downloadedFileName = $null
        foreach ($file in $downloadedFiles) {
            if ($file.Extension -eq ".crdownload" -or $file.Extension -eq ".tmp") {
                # Skip files being currently downloaded
                continue
            }
            elseif ($file.LastWriteTime -ge (Get-Date).AddSeconds(-10)) {
                # File has been downloaded within the last 10 seconds
                $fileDownloaded = $true
                $downloadedFileName = $file.Name
                break
            }
        }

        # If file downloaded, update CSV with the downloaded file name
        if ($fileDownloaded) {
            # Add file name to the D column
            $url | Add-Member -MemberType NoteProperty -Name "DownloadedFile" -Value $downloadedFileName
            $url | Export-Csv -Path $csvPath -NoTypeInformation -Append
        }
    }

    # Close the Chrome session after opening the batch
    Start-Sleep -Seconds 10  # Wait for 10 seconds before closing
    taskkill /IM "chrome.exe" /F /T  # Terminate Chrome process forcefully
    Start-Sleep -Seconds 2   # Additional delay to ensure Chrome is fully terminated
}
