
Install-Module ImportExcel -Scope CurrentUser



# Path to the Excel file
$excelFilePath = "P:\Invasion\URLPDF.xlsx"

# Import Excel using Import-Excel cmdlet from the ImportExcel module
Import-Module ImportExcel
$urls = Import-Excel -Path $excelFilePath

# Loop through each URL
for ($i = 0; $i -lt $urls.Count; $i++) {
    # Open URL in Chrome
    Start-Process "chrome.exe" -ArgumentList $urls[$i].Url

    # Wait for the download to complete
    Start-Sleep -Seconds 5 # Adjust this time according to your download speed and file sizes

    # Get the downloaded file name
    $downloadedFile = Get-ChildItem -Path $env:USERPROFILE\Downloads | Sort-Object -Property LastWriteTime -Descending | Select-Object -First 1

    # Update the Excel with the downloaded file name
    $urls[$i].D = $downloadedFile.Name
    $urls | Export-Excel -Path $excelFilePath -AutoSize -NoHeader -NoTitle -Show

    # Wait for 10 seconds before moving to the next URL
    Start-Sleep -Seconds 5

    # Kill Chrome after processing every 50 URLs
    if (($i + 1) % 50 -eq 0) {
        # Wait for 5 seconds before killing Chrome
        Start-Sleep -Seconds 5

        # Kill Chrome
        Stop-Process -Name "chrome" -Force
    }
}
