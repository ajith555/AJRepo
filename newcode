# Define the path to the Excel file
$excelFilePath = "P:\Invasion\URLPDF.xlsx"

# Create a COM object for Excel
$excel = New-Object -ComObject Excel.Application
$excel.Visible = $false

# Open the Excel file
$workbook = $excel.Workbooks.Open($excelFilePath)
$worksheet = $workbook.Sheets.Item(1)

# Get the number of rows in the URL column
$urlColumn = $worksheet.Columns.Item("A").EntireColumn
$numUrls = ($urlColumn.SpecialCells(11).Count) - 1  # Subtract 1 for the header row

# Loop through each URL
for ($i = 2; $i -le $numUrls + 1; $i++) {
    # Get the URL from the current row
    $url = $worksheet.Cells.Item($i, 1).Value2

    # Open the URL in Chrome
    Start-Process "chrome.exe" -ArgumentList $url

    # Wait for 5 seconds
    Start-Sleep -Seconds 5

    # Check if Chrome has been open for 50 URLs
    if ($i % 50 -eq 0) {
        # Kill the Chrome process
        Stop-Process -Name "chrome" -Force

        # Wait for a moment before restarting Chrome
        Start-Sleep -Seconds 5

        # Restart Chrome
        Start-Process "chrome.exe"
    }

    # Prompt the user to enter the downloaded file name
    $fileName = Read-Host "Enter the downloaded file name for URL: $url"

    # Save the file name in the FileName column
    $worksheet.Cells.Item($i, 2).Value2 = $fileName
}

# Save and close the Excel file
$workbook.Save()
$workbook.Close()
$excel.Quit()

# Release COM objects
[System.Runtime.Interopservices.Marshal]::ReleaseComObject($worksheet) | Out-Null
[System.Runtime.Interopservices.Marshal]::ReleaseComObject($workbook) | Out-Null
[System.Runtime.Interopservices.Marshal]::ReleaseComObject($excel) | Out-Null
[System.GC]::Collect()
[System.GC]::WaitForPendingFinalizers()

Write-Host "Task completed."
