# Define the path to the Excel file
$excelFilePath = "P:\Invasion\URLPDF.xlsx"

# Create a COM object for Excel
$excel = New-Object -ComObject Excel.Application
$excel.Visible = $false

# Open the Excel file
$workbook = $excel.Workbooks.Open($excelFilePath)
$worksheet = $workbook.Sheets.Item(1)

# Get the number of rows in the URL column
$urlColumn = $worksheet.Columns.Item("C").EntireColumn
$numUrls = ($urlColumn.SpecialCells(11).Count)

# Loop through each URL
for ($i = 2; $i -le $numUrls; $i++) {
    # Get the URL from the current row
    $url = $worksheet.Cells.Item($i, 3).Value2

    # Open the URL in Chrome
    Start-Process "chrome.exe" -ArgumentList $url

    # Wait for 5 seconds
    Start-Sleep -Seconds 5

    # Check if Chrome has been open for 50 URLs
    if ($i % 50 -eq 0) {
        # Kill the Chrome process
        Stop-Process -Name "chrome" -Force

        # Wait for a moment before restarting Chrome
        Start-Sleep -Seconds 5

        # Restart Chrome
        Start-Process "chrome.exe"
    }

    # Get the most recently downloaded file in the Downloads folder
    $latestFile = Get-ChildItem -Path $env:USERPROFILE\Downloads | Sort-Object LastWriteTime -Descending | Select-Object -First 1

    # Extract the file name
    $fileName = $latestFile.Name

    # Update the FileName column in Excel
    $worksheet.Cells.Item($i, 4).Value2 = $fileName
}

# Save and close the Excel file
$workbook.Save()
$workbook.Close()
$excel.Quit()

# Release COM objects
[System.Runtime.Interopservices.Marshal]::ReleaseComObject($worksheet) | Out-Null
[System.Runtime.Interopservices.Marshal]::ReleaseComObject($workbook) | Out-Null
[System.Runtime.Interopservices.Marshal]::ReleaseComObject($excel) | Out-Null
[System.GC]::Collect()
[System.GC]::WaitForPendingFinalizers()

Write-Host "Task completed."
