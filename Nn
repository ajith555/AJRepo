Option Explicit

Dim objExcelApplication As Object
Dim objExcelWorkbook As Object
Dim objExcelWorksheet As Object
Dim objNamespace As Object
Dim objSentItemsFolder As Object

Sub FetchRepliedEmails()
    ' Create Excel objects
    Set objExcelApplication = CreateObject("Excel.Application")
    objExcelApplication.Visible = True ' Set Excel application visible before working with columns

    Set objExcelWorkbook = objExcelApplication.Workbooks.Add
    Set objExcelWorksheet = objExcelWorkbook.Worksheets(1)
    
    ' Set fixed row height for all rows in the worksheet
    objExcelWorksheet.Rows.RowHeight = 20

    With objExcelWorksheet
        .Cells(1, 1) = "Subject"
        .Cells(1, 1).Font.Bold = True
        .Cells(1, 2) = "Received Time"
        .Cells(1, 2).Font.Bold = True
        .Cells(1, 3) = "Sender"
        .Cells(1, 3).Font.Bold = True
    End With
    
    ' Get the Outlook Namespace and "Sent Items" folder
    Set objNamespace = GetObject("", "Outlook.Application").GetNamespace("MAPI")
    Set objSentItemsFolder = objNamespace.GetDefaultFolder(5) ' olFolderSentMail

    ' Fetch and display replied emails within the last 24 hours
    FetchAndDisplayRepliedEmails objSentItemsFolder

    ' Format the Excel columns and rows
    With objExcelWorksheet
        .Columns("A:C").AutoFit
    End With

    ' Clean up
    Set objExcelWorksheet = Nothing
    Set objExcelWorkbook = Nothing
End Sub

Sub FetchAndDisplayRepliedEmails(ByVal objFolder As Object)
    Dim objItem As Object
    Dim rowIndex As Integer
    
    rowIndex = 2 ' Start from the second row (first row is for headers)
    
    For Each objItem In objFolder.Items
        If TypeOf objItem Is Object Then ' Check if the item is an object
            Dim objMail As Object
            Set objMail = objItem ' Cast the item to an object
            
            ' Check if the email is a reply (not the initial email) and within the last 24 hours
            If objMail.Reply = True And DateDiff("h", objMail.ReceivedTime, Now) <= 24 Then
                With objExcelWorksheet
                    .Cells(rowIndex, 1) = objMail.Subject
                    .Cells(rowIndex, 2) = objMail.ReceivedTime
                    .Cells(rowIndex, 3) = objMail.SenderName
                End With
                rowIndex = rowIndex + 1
            End If
        End If
    Next objItem
End Sub
