# Import the required modules
Import-Module ImportExcel

# Define the API endpoint and headers
$apiUrl = "https://example.com/api/endpoint"
$headers = @{
    "apikey" = "your_api_key"
}

# Send a GET request to the API and retrieve the JSON response
$response = Invoke-RestMethod -Uri $apiUrl -Headers $headers

# Convert the JSON response to a PowerShell object
$data = $response | ConvertFrom-Json

# Create a new Excel workbook
$workbook = New-ExcelWorkbook

# Select the first worksheet
$worksheet = $workbook | Get-ExcelWorksheet -WorksheetName "Sheet1"

# Define the column names based on your JSON structure
$columnNames = "Field1", "Field2", "Field3" # Modify this according to your JSON structure

# Add the column names to the worksheet
$worksheet | Add-ExcelRange -StartRow 1 -StartColumn 1 -Value $columnNames -Bold

# Populate the worksheet with data
$row = 2
foreach ($item in $data) {
    $field1Value = $item.Field1 # Modify the property names according to your JSON structure
    $field2Value = $item.Field2
    $field3Value = $item.Field3

    $rowData = $field1Value, $field2Value, $field3Value # Modify this line according to your JSON structure

    $worksheet | Add-ExcelRange -StartRow $row -StartColumn 1 -Value $rowData

    $row++
}

# Save the workbook to a file
$excelFilePath = "C:\Path\to\output.xlsx" # Specify the desired output file path
$workbook | Export-Excel -Path $excelFilePath -AutoSize

# Close the workbook
$workbook | Close-ExcelWorkbook
