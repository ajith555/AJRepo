# Define the API endpoint and headers
$apiUrl = "https://example.com/api/endpoint"
$headers = @{
    "apikey" = "your_api_key"
}

# Send a GET request to the API and retrieve the JSON response
$response = Invoke-RestMethod -Uri $apiUrl -Headers $headers

# Convert the JSON response to a PowerShell object
$data = $response | ConvertFrom-Json

# Convert the data to CSV format
$csvData = $data | ConvertTo-Csv -NoTypeInformation

# Specify the desired output file path
$csvFilePath = "C:\Path\to\output.csv"

# Save the data to a CSV file
$csvData | Out-File -FilePath $csvFilePath -Encoding UTF8

# Output a success message
Write-Host "Data saved to $csvFilePath"
