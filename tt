import requests
from bs4 import BeautifulSoup
import json

def fetch_json_data_from_api(api_url, cookie_name, cookie_value):
    # Set up the request headers with the cookie
    headers = {'Cookie': f'{cookie_name}={cookie_value}'}

    try:
        # Make the API request with SSL certificate verification enabled (recommended for production)
        response = requests.get(api_url, headers=headers)
        response.raise_for_status()  # Check for any HTTP errors
    except requests.exceptions.RequestException as e:
        print(f"API request failed: {e}")
        return None

    # Parse the HTML content using BeautifulSoup
    soup = BeautifulSoup(response.content, 'html.parser')

    # Find the JSON data within the HTML (adjust this based on the HTML structure)
    json_script = soup.find('script', {'type': 'application/json'})

    if json_script is not None and json_script.string:
        try:
            # Parse the JSON string into a JSON object
            json_data = json.loads(json_script.string)
            return json_data
        except json.JSONDecodeError as e:
            print(f"Failed to parse JSON data: {e}")
            return None
    else:
        print("JSON data not found in the API response.")
        return None

if __name__ == "__main__":
    api_url = 'https://api.example.com/endpoint'
    cookie_name = 'session_cookie'
    cookie_value = 'abc123def456'

    json_data = fetch_json_data_from_api(api_url, cookie_name, cookie_value)

    if json_data:
        # Now you can access the key-value data in the JSON object
        print(json_data['key'])
