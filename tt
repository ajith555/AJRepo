import os
import zipfile

# Set the folder location containing email files
folder_location = 'path/to/emails/'

# Set the save location for attachments
save_location = 'path/to/save/location/'

# Iterate over the files in the folder
for filename in os.listdir(folder_location):
    file_path = os.path.join(folder_location, filename)

    # Read the email information from the file
    with open(file_path, 'rb') as file:
        lines = file.read().decode('latin-1').splitlines()

    # Process each line
    for line in lines:
        email_info = line.split('|')

        # Check if the email information contains the expected number of elements
        if len(email_info) != 3:
            print(f"Skipping invalid line: {line}")
            continue

        subject, attachment_name, attachment_path = email_info

        # Check if the subject matches 'abcd'
        if subject == 'abcd':
            # Check if the attachment is a zip file and unzip it
            if attachment_path.endswith('.zip'):
                unzip_location = os.path.join(save_location, attachment_name.split('.')[0])
                os.makedirs(unzip_location, exist_ok=True)  # Create the unzip location path if it doesn't exist
                with zipfile.ZipFile(attachment_path, 'r') as zip_ref:
                    zip_ref.extractall(unzip_location)

                print(f"Unzipped attachment: {attachment_name}")
            else:
                print(f"Attachment is not a zip file: {attachment_name}")

            # Move the attachment to the final save location
            os.makedirs(save_location, exist_ok=True)  # Create the save location path if it doesn't exist
            final_path = os.path.join(save_location, attachment_name)
            os.rename(attachment_path, final_path)

            print(f"Saved attachment: {attachment_name}")
            break  # Exit the loop after processing one email
