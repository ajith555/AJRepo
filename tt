import os
import zipfile

# Set the folder location containing email files
folder_location = 'path/to/emails/'

# Set the save location for attachments
save_location = 'path/to/save/location/'

# Iterate over the files in the folder
for filename in os.listdir(folder_location):
    file_path = os.path.join(folder_location, filename)

    # Check if the file is a text file and the subject matches 'abcd'
    if filename.endswith('.txt') and filename.split('.')[0] == 'abcd':
        # Read the email information from the file
        with open(file_path, 'r') as file:
            lines = file.readlines()

        # Process each line
        for line in lines:
            attachment_path = line.strip()

            # Check if the attachment exists and is a file
            if os.path.isfile(attachment_path):
                # Check if the attachment is a zip file and unzip it
                if attachment_path.endswith('.zip'):
                    unzip_location = os.path.join(save_location, os.path.splitext(os.path.basename(attachment_path))[0])
                    os.makedirs(unzip_location, exist_ok=True)  # Create the unzip location path if it doesn't exist
                    with zipfile.ZipFile(attachment_path, 'r') as zip_ref:
                        zip_ref.extractall(unzip_location)

                    print(f"Unzipped attachment: {attachment_path}")
                else:
                    print(f"Attachment is not a zip file: {attachment_path}")

                # Move the attachment to the final save location
                os.makedirs(save_location, exist_ok=True)  # Create the save location path if it doesn't exist
                final_path = os.path.join(save_location, os.path.basename(attachment_path))
                os.rename(attachment_path, final_path)

                print(f"Saved attachment: {final_path}")
                break  # Exit the loop after processing one attachment
        break  # Exit the loop after processing one email
