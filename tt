import os
import win32com.client

# Set up the Outlook 365 credentials
credentials = {
    "username": "Your_Email_Address",
    "password": "Your_Password"
}

# Set the folder name and subject of the emails you want to retrieve
folder_name = "Folder_Name"
subject = "abc"

# Set the path to save the email
save_path = "Your_Desired_Save_Path"

# Connect to Outlook 365
outlook = win32com.client.Dispatch("Outlook.Application")
namespace = outlook.GetNamespace("MAPI")
namespace.Logon(*credentials.values(), True, False)

# Get the specified folder
folder = namespace.Folders.Item(1).Folders[folder_name]

# Retrieve emails with the specified subject
emails = folder.Items.Restrict("[Subject]='{}'".format(subject))
emails.Sort("[ReceivedTime]", True)

if emails.Count > 0:
    # Get the latest email
    email = emails.GetFirst()

    # Save the email as an .msg file
    email.SaveAs(os.path.join(save_path, "latest_email.msg"))

    print("Latest email saved successfully.")
else:
    print("No email found with the specified subject.")

# Disconnect from Outlook 365
namespace.Logoff()
