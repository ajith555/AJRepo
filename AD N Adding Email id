Option Explicit

'=======================
' Main Macro
'=======================
Public Sub UpdateCopySheet(strArgumentAH As String)
    Dim wbMacro As Workbook, wbCopy As Workbook
    Dim wsRules As Worksheet, wsCopy As Worksheet
    Dim lastRowRules As Long, lastRowCopy As Long
    Dim i As Long, j As Long, k As Long
    Dim tVal As String, anVal As String, amVal As String, alVal As String
    Dim aqVal As Variant, joinYear As Long
    Dim ruleA As String, ruleB As String, ruleC As String, ruleD As String, ruleE As String, ruleF As String
    Dim todayYear As Long
    Dim matched As Boolean
    Dim exceptions As Variant, foundExc As Boolean
    
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    
    Set wbMacro = ThisWorkbook
    Set wsRules = wbMacro.Sheets("AH")
    
    ' Open the target file
    Set wbCopy = Workbooks.Open(strArgumentAH)
    Set wsCopy = wbCopy.Sheets("Copy")
    
    lastRowRules = wsRules.Cells(wsRules.Rows.Count, "A").End(xlUp).Row
    lastRowCopy = wsCopy.Cells(wsCopy.Rows.Count, "A").End(xlUp).Row
    
    todayYear = Year(Date)
    
    ' Loop over rules in AH sheet
    For i = 2 To lastRowRules
        ruleA = Trim(wsRules.Cells(i, "A").Value)
        ruleB = Trim(wsRules.Cells(i, "B").Value)
        ruleC = Trim(wsRules.Cells(i, "C").Value)
        ruleD = Trim(wsRules.Cells(i, "D").Value)
        ruleE = Trim(wsRules.Cells(i, "E").Value)
        ruleF = Trim(wsRules.Cells(i, "F").Value)
        
        ' Loop over rows in Copy sheet
        For j = 2 To lastRowCopy
            ' Skip if AH already filled
            If wsCopy.Cells(j, "AH").Value <> "" Then GoTo NextRow
