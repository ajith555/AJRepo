Sub FetchSentItemsToExcel()
    Dim olApp As Outlook.Application
    Dim olNamespace As Outlook.Namespace
    Dim olFolder As Outlook.MAPIFolder
    Dim olItems As Outlook.Items
    Dim olMail As Object ' Use Object to handle different types of items
    Dim startTime As Date
    Dim emailAddress As String
    Dim hoursAgo As Integer
    Dim xlApp As Object
    Dim xlWorkbook As Object
    Dim xlWorksheet As Object
    Dim rowCount As Integer
    
    ' Set the email address and number of hours
    emailAddress = "kushal-ajith.shetty@ubs.com"
    hoursAgo = 24
    
    ' Set the Outlook Application and Namespace
    Set olApp = New Outlook.Application
    Set olNamespace = olApp.GetNamespace("MAPI")
    
    ' Get the Sent Items folder of the specified email address
    On Error Resume Next
    Set olFolder = olNamespace.GetDefaultFolder(olFolderSentMail).Folders("Sent Items")
    On Error GoTo 0
    
    If olFolder Is Nothing Then
        MsgBox "Sent Items folder not found for the specified email address."
        Exit Sub
    End If
    
    ' Set the time range
    startTime = Now - hoursAgo / 24 ' Convert hours to days
    
    ' Initialize the collection of items
    Set olItems = olFolder.Items.Restrict("[SentOn] >= '" & Format(startTime, "yyyy-mm-dd hh:mm:ss") & "'")
    
    ' Create a new Excel instance and workbook
    Set xlApp = CreateObject("Excel.Application")
    xlApp.Visible = True
    Set xlWorkbook = xlApp.Workbooks.Add
    Set xlWorksheet = xlWorkbook.Sheets(1)
    
    ' Add headers to the Excel worksheet
    xlWorksheet.Cells(1, 1).Value = "Subject"
    xlWorksheet.Cells(1, 2).Value = "Sender"
    xlWorksheet.Cells(1, 3).Value = "Recipient"
    
    ' Loop through and process the emails
    rowCount = 2 ' Start from the second row
    For Each olMail In olItems
        If TypeOf olMail Is Object Then
            Set olMail = olItems.GetLast()
            xlWorksheet.Cells(rowCount, 1).Value = olMail.Subject
            xlWorksheet.Cells(rowCount, 2).Value = olMail.SenderEmailAddress
            xlWorksheet.Cells(rowCount, 3).Value = olMail.To
            rowCount = rowCount + 1
        End If
    Next olMail
    
    ' Clean up
    Set xlWorksheet = Nothing
    Set xlWorkbook = Nothing
    Set xlApp = Nothing
    Set olMail = Nothing
    Set olItems = Nothing
    Set olFolder = Nothing
    Set olNamespace = Nothing
    Set olApp = Nothing
End Sub
