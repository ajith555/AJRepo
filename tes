Sub MoveExternalEmails()
    Dim olApp As Object, olNs As Object, olFolder As Object
    Dim olMail As Object
    Dim domainToCheck As String, moveToFolderName As String
    Dim targetFolder As Object
    
    domainToCheck = "@abc.com"
    moveToFolderName = "External Email"
    
    Set olApp = CreateObject("Outlook.Application")
    Set olNs = olApp.GetNamespace("MAPI")
    
    ' Change "Inbox" to the name of the folder you want to start from
    Set olFolder = olNs.GetDefaultFolder(6).Folders("Inbox")
    
    On Error Resume Next
    ' Attempt to find the target folder
    Set targetFolder = olFolder.Folders(moveToFolderName)
    On Error GoTo 0
    
    ' If target folder doesn't exist, create it
    If targetFolder Is Nothing Then
        Set targetFolder = olFolder.Folders.Add(moveToFolderName)
    End If
    
    ' Process the main folder
    ProcessFolder olFolder, domainToCheck, targetFolder
    
    MsgBox "External emails have been moved to the designated folder."
    
    Set olApp = Nothing
    Set olNs = Nothing
    Set olFolder = Nothing
    Set targetFolder = Nothing
End Sub

Sub ProcessFolder(folder As Object, domainToCheck As String, targetFolder As Object)
    Dim olMail As Object
    Dim i As Long
    
    For i = folder.Items.Count To 1 Step -1
        If folder.Items(i).Class = 43 Then ' MailItem
            Set olMail = folder.Items(i)
            If LCase(Right(olMail.SenderEmailAddress, Len(domainToCheck))) <> LCase(domainToCheck) Then
                olMail.Move targetFolder
            End If
        End If
    Next i
    
    Dim subfolder As Object
    For Each subfolder In folder.Folders
        ProcessFolder subfolder, domainToCheck, targetFolder
    Next subfolder
End Sub
