Option Explicit

Dim objExcelApplication As Excel.Application
Dim objExcelWorkbook As Excel.Workbook
Dim objExcelWorksheet As Excel.Worksheet
Dim objNamespace As Outlook.Namespace
Dim objSentItemsFolder As Outlook.Folder

Sub FetchEmailsFromSentItems()
    ' Create Excel objects
    Set objExcelApplication = New Excel.Application
    objExcelApplication.Visible = True ' Set Excel application visible before working with columns

    Set objExcelWorkbook = objExcelApplication.Workbooks.Add
    Set objExcelWorksheet = objExcelWorkbook.Worksheets(1)
    
    ' Set fixed row height for all rows in the worksheet
    objExcelWorksheet.Rows.RowHeight = 20

    With objExcelWorksheet
        .Cells(1, 1) = "Subject"
        .Cells(1, 1).Font.Bold = True
        .Cells(1, 2) = "Received"
        .Cells(1, 2).Font.Bold = True
        .Cells(1, 3) = "Sender"
        .Cells(1, 3).Font.Bold = True
    End With
    
    ' Get the Outlook Namespace and "Sent Items" folder
    Set objNamespace = Outlook.GetNamespace("MAPI")
    Set objSentItemsFolder = objNamespace.GetDefaultFolder(olFolderSentMail)

    ' Fetch and display emails from "Sent Items" folder
    FetchAndDisplayEmails objSentItemsFolder

    ' Format the Excel columns and rows
    With objExcelWorksheet
        .Columns("A:C").AutoFit
    End With

    ' Clean up
    Set objExcelWorksheet = Nothing
    Set objExcelWorkbook = Nothing
End Sub

Sub FetchAndDisplayEmails(ByVal objFolder As Outlook.Folder)
    Dim objMail As Outlook.MailItem
    Dim rowIndex As Integer
    
    rowIndex = 2 ' Start from the second row (first row is for headers)
    
    For Each objMail In objFolder.Items
        If objMail.Class = olMail Then
            With objExcelWorksheet
                .Cells(rowIndex, 1) = objMail.Subject
                .Cells(rowIndex, 2) = objMail.ReceivedTime
                .Cells(rowIndex, 3) = objMail.SenderName
            End With
            rowIndex = rowIndex + 1
        End If
    Next objMail
End Sub
