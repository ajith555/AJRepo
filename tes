Sub MoveExternalEmails()
    Dim olApp As Object, olNs As Object
    Dim olFolder As Object, targetFolder As Object
    Dim olMail As Object
    
    Set olApp = CreateObject("Outlook.Application")
    Set olNs = olApp.GetNamespace("MAPI")
    Set olFolder = olNs.GetDefaultFolder(6) ' Inbox
    
    On Error Resume Next
    Set targetFolder = olFolder.Folders("External Email")
    On Error GoTo 0
    
    If targetFolder Is Nothing Then
        Set targetFolder = olFolder.Folders.Add("External Email")
    End If
    
    ProcessFolder olFolder, targetFolder
    
    MsgBox "External emails have been moved."
    
    Set olApp = Nothing
    Set olNs = Nothing
    Set olFolder = Nothing
    Set targetFolder = Nothing
End Sub

Sub ProcessFolder(folder As Object, targetFolder As Object)
    Dim olMail As Object, i As Long
    
    For i = folder.Items.Count To 1 Step -1
        If folder.Items(i).Class = 43 Then ' MailItem
            Set olMail = folder.Items(i)
            If Not IsInternalAddress(olMail) Then
                olMail.Move targetFolder
            End If
        End If
    Next i
    
    Dim subfolder As Object
    For Each subfolder In folder.Folders
        ProcessFolder subfolder, targetFolder
    Next subfolder
End Sub

Function IsInternalAddress(mail As Object) As Boolean
    Dim senderDomain As String
    senderDomain = Split(mail.SenderEmailAddress, "@")(UBound(Split(mail.SenderEmailAddress, "@")))
    If mail.SenderEmailType = "EX" Or mail.SenderEmailType = "SMTP" Then
        If LCase(senderDomain) = "abc.com" Then
            IsInternalAddress = True
        End If
    End If
End Function
