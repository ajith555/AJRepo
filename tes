Sub MoveExternalEmails()
    Dim olApp As Object, olNs As Object, olFolder As Object
    Dim olMail As Object
    Dim domainToCheck As String, moveToFolderName As String
    
    domainToCheck = "@abc.com"
    moveToFolderName = "External Email"
    
    Set olApp = CreateObject("Outlook.Application")
    Set olNs = olApp.GetNamespace("MAPI")
    
    ' Change "Inbox" to the name of the folder you want to start from
    Set olFolder = olNs.GetDefaultFolder(6).Folders("Inbox")
    
    On Error Resume Next
    ' Attempt to find the target folder
    Set targetFolder = olFolder.Folders(moveToFolderName)
    On Error GoTo 0
    
    ' If target folder doesn't exist, create it
    If targetFolder Is Nothing Then
        Set targetFolder = olFolder.Folders.Add(moveToFolderName)
    End If
    
    ' Loop through emails in the folder and its subfolders
    For Each olMail In olFolder.Items
        If olMail.Class = 43 And Not LCase(Right(olMail.SenderEmailAddress, Len(domainToCheck))) = LCase(domainToCheck) Then
            olMail.Move targetFolder
        End If
    Next olMail
    
    ' Process subfolders
    ProcessSubfolders olFolder, domainToCheck, targetFolder
    
    MsgBox "External emails have been moved to the designated folder."
    
    Set olApp = Nothing
    Set olNs = Nothing
    Set olFolder = Nothing
    Set targetFolder = Nothing
End Sub

Sub ProcessSubfolders(parentFolder As Object, domainToCheck As String, targetFolder As Object)
    Dim subfolder As Object
    Dim olMail As Object
    
    For Each subfolder In parentFolder.Folders
        For Each olMail In subfolder.Items
            If olMail.Class = 43 And Not LCase(Right(olMail.SenderEmailAddress, Len(domainToCheck))) = LCase(domainToCheck) Then
                olMail.Move targetFolder
            End If
        Next olMail
        ProcessSubfolders subfolder, domainToCheck, targetFolder
    Next subfolder
End Sub
